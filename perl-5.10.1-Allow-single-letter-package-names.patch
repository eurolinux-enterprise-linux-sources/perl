From 363ab1d4ddb90d742ca28da548fa67108a12641b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= <ppisar@redhat.com>
Date: Wed, 7 Jan 2015 09:25:20 +0100
Subject: [PATCH] Allow single letter package names
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Upstream patch:

    From 7872bc27ac7f828a6b53d00717abdf83f2d1866d Mon Sep 17 00:00:00 2001
    From: Simon Wistow <simon@fastly.com>
    Date: Tue, 22 Oct 2013 09:32:27 -0700
    Subject: [PATCH] Allow single letter package names

ported to perl-5.10.1.

Signed-off-by: Petr Písař <ppisar@redhat.com>
---
 MANIFEST                                           |  2 ++
 .../lib/Module/Pluggable/Object.pm                 |  2 +-
 ext/Module-Pluggable/t/25single_letter_package.t   | 42 ++++++++++++++++++++++
 ext/Module-Pluggable/t/lib/M/X.pm                  |  7 ++++
 4 files changed, 52 insertions(+), 1 deletion(-)
 create mode 100755 ext/Module-Pluggable/t/25single_letter_package.t
 create mode 100644 ext/Module-Pluggable/t/lib/M/X.pm

diff --git a/MANIFEST b/MANIFEST
index 9bb54ab..2f7f300 100644
--- a/MANIFEST
+++ b/MANIFEST
@@ -1023,6 +1023,7 @@ ext/Module-Pluggable/t/18skipped_package.t	Module::Pluggable tests
 ext/Module-Pluggable/t/19can_ok_clobber.t	Module::Pluggable tests
 ext/Module-Pluggable/t/20dodgy_files.t	Module::Pluggable tests
 ext/Module-Pluggable/t/21editor_junk.t			Module::Pluggable tests
+ext/Module-Pluggable/t/25single_letter_package.t		Module::Pluggable tests
 ext/Module-Pluggable/t/acme/Acme/MyTest/Plugin/Foo.pm	Module::Pluggable tests
 ext/Module-Pluggable/t/lib/Acme/Foo-Bar.pm			Module::Pluggable tests
 ext/Module-Pluggable/t/lib/Acme/MyTest/Plugin/Foo.pm	Module::Pluggable tests
@@ -1035,6 +1036,7 @@ ext/Module-Pluggable/t/lib/ExtTest/Plugin/Bar.plugin	Module::Pluggable tests
 ext/Module-Pluggable/t/lib/ExtTest/Plugin/Foo.plugin	Module::Pluggable tests
 ext/Module-Pluggable/t/lib/ExtTest/Plugin/Quux/Foo.plugin	Module::Pluggable tests
 ext/Module-Pluggable/t/lib/InnerTest/Plugin/Foo.pm	Module::Pluggable tests
+ext/Module-Pluggable/t/lib/M/X.pm			Module::Pluggable tests
 ext/Module-Pluggable/t/lib/MyOtherTest/Plugin/Bar.pm	Module::Pluggable tests
 ext/Module-Pluggable/t/lib/MyOtherTest/Plugin/Foo.pm	Module::Pluggable tests
 ext/Module-Pluggable/t/lib/MyOtherTest/Plugin/Quux/Foo.pm	Module::Pluggable tests
diff --git a/ext/Module-Pluggable/lib/Module/Pluggable/Object.pm b/ext/Module-Pluggable/lib/Module/Pluggable/Object.pm
index e0ee993..b20739c 100644
--- a/ext/Module-Pluggable/lib/Module/Pluggable/Object.pm
+++ b/ext/Module-Pluggable/lib/Module/Pluggable/Object.pm
@@ -218,7 +218,7 @@ sub search_paths {
             }
             my $plugin = join '::', $searchpath, @dirs, $name;
 
-            next unless $plugin =~ m!(?:[a-z\d]+)[a-z\d]!i;
+            next unless $plugin =~ m!(?:[a-z\d]+)[a-z\d]*!i;
 
             my $err = $self->handle_finding_plugin($plugin);
             carp "Couldn't require $plugin : $err" if $err;
diff --git a/ext/Module-Pluggable/t/25single_letter_package.t b/ext/Module-Pluggable/t/25single_letter_package.t
new file mode 100755
index 0000000..dd55fff
--- /dev/null
+++ b/ext/Module-Pluggable/t/25single_letter_package.t
@@ -0,0 +1,42 @@
+#!perl -w
+
+use strict;
+use FindBin;
+use lib (($FindBin::Bin."/lib")=~/^(.*)$/);
+use Test::More tests => 5;
+
+my $foo;
+ok($foo = M->new());
+
+my @plugins;
+my @expected = qw(M::X);
+ok(@plugins = sort $foo->plugins);
+
+
+
+is_deeply(\@plugins, \@expected, "is deeply");
+
+@plugins = ();
+
+ok(@plugins = sort M->plugins);
+
+
+
+
+is_deeply(\@plugins, \@expected, "is deeply class");
+
+
+
+package M;
+
+use strict;
+use Module::Pluggable search_path => "M";
+
+
+sub new {
+    my $class = shift;
+    return bless {}, $class;
+
+}
+1;
+
diff --git a/ext/Module-Pluggable/t/lib/M/X.pm b/ext/Module-Pluggable/t/lib/M/X.pm
new file mode 100644
index 0000000..77f8f58
--- /dev/null
+++ b/ext/Module-Pluggable/t/lib/M/X.pm
@@ -0,0 +1,7 @@
+package M::X;
+
+use strict;
+
+sub new { return bless {}, $_[0]; }
+sub frobnitz {}
+1;
-- 
1.9.3

